import deepmerge from "https://esm.sh/deepmerge@4.2.2";
const ValidWorkflowFlags = [
    "if",
    "debug",
    "database",
    "sleep",
    "limit",
    "force"
];
const ValidCliWorkflowFlags = ValidWorkflowFlags.concat("files");
function filterValidSourceOptions(options) {
    const { force , limit , debug  } = options || {};
    const validSourceOptions = {
        force,
        limit,
        debug
    };
    Object.keys(validSourceOptions).forEach((key)=>validSourceOptions[key] === undefined && delete validSourceOptions[key]);
    return validSourceOptions;
}
function filterValidCliOptions(options) {
    const validWorkflowOptions = {};
    ValidCliWorkflowFlags.forEach((key)=>{
        if (key in options) {
            validWorkflowOptions[key] = options[key];
        }
    });
    return validWorkflowOptions;
}
function filterValidWorkflowOptions(options) {
    const validWorkflowOptions = {};
    ValidWorkflowFlags.forEach((key)=>{
        if (key in options) {
            validWorkflowOptions[key] = options[key];
        }
    });
    return validWorkflowOptions;
}
export function getFinalWorkflowOptions(WorkflowOptions, runWorkflowOptions) {
    let database = "json://data";
    if (runWorkflowOptions.content) {
        database = "json:///tmp/denoflow/data";
    }
    const defaultOptions = {
        debug: false,
        database: database,
        if: true
    };
    const finalOptions = mergeAll([
        defaultOptions,
        filterValidWorkflowOptions(WorkflowOptions),
        filterValidCliOptions(runWorkflowOptions)
    ]);
    return finalOptions;
}
export function getFinalSourceOptions(WorkflowOptions, runWorkflowOptions, sourceOptions) {
    const defaultOptions = {
        force: false,
        debug: false,
        if: true
    };
    const validRunWorkflowOptions = filterValidSourceOptions(runWorkflowOptions);
    const finalOptions = mergeAll([
        defaultOptions,
        WorkflowOptions,
        sourceOptions,
        validRunWorkflowOptions
    ]);
    return finalOptions;
}
export function getFinalRunOptions(runWorkflowOptions, isDebug) {
    const defaultOptions = {
        files: [
            "workflows"
        ],
        debug: isDebug,
        stdin: false
    };
    const finalOptions = mergeAll([
        defaultOptions,
        runWorkflowOptions
    ]);
    return finalOptions;
}
const overwriteMerge = (_, sourceArray, __)=>sourceArray;
export function mergeAll(arr) {
    return deepmerge.all(arr, {
        arrayMerge: overwriteMerge
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvZGVub2Zsb3dAMC4wLjMzL2NvcmUvZGVmYXVsdC1vcHRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIFJ1bldvcmtmbG93T3B0aW9ucyxcbiAgU291cmNlT3B0aW9ucyxcbiAgV29ya2Zsb3dPcHRpb25zLFxufSBmcm9tIFwiLi9pbnRlcmZhY2UudHNcIjtcbmltcG9ydCB7IEludGVybmFsUnVuV29ya2Zsb3dPcHRpb25zIH0gZnJvbSBcIi4vaW50ZXJuYWwtaW50ZXJmYWNlLnRzXCI7XG5pbXBvcnQgZGVlcG1lcmdlIGZyb20gXCJodHRwczovL2VzbS5zaC9kZWVwbWVyZ2VANC4yLjJcIjtcblxuY29uc3QgVmFsaWRXb3JrZmxvd0ZsYWdzID0gW1xuICBcImlmXCIsXG4gIFwiZGVidWdcIixcbiAgXCJkYXRhYmFzZVwiLFxuICBcInNsZWVwXCIsXG4gIFwibGltaXRcIixcbiAgXCJmb3JjZVwiLFxuXTtcbmNvbnN0IFZhbGlkQ2xpV29ya2Zsb3dGbGFncyA9IFZhbGlkV29ya2Zsb3dGbGFncy5jb25jYXQoXCJmaWxlc1wiKTtcbmZ1bmN0aW9uIGZpbHRlclZhbGlkU291cmNlT3B0aW9ucyhcbiAgb3B0aW9uczogUnVuV29ya2Zsb3dPcHRpb25zLFxuKTogU291cmNlT3B0aW9ucyB7XG4gIGNvbnN0IHsgZm9yY2UsIGxpbWl0LCBkZWJ1ZyB9ID0gb3B0aW9ucyB8fCB7fTtcblxuICBjb25zdCB2YWxpZFNvdXJjZU9wdGlvbnM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge1xuICAgIGZvcmNlLFxuICAgIGxpbWl0LFxuICAgIGRlYnVnLFxuICB9O1xuICBPYmplY3Qua2V5cyh2YWxpZFNvdXJjZU9wdGlvbnMpLmZvckVhY2goKGtleSkgPT5cbiAgICB2YWxpZFNvdXJjZU9wdGlvbnNba2V5XSA9PT0gdW5kZWZpbmVkICYmIGRlbGV0ZSB2YWxpZFNvdXJjZU9wdGlvbnNba2V5XVxuICApO1xuXG4gIHJldHVybiB2YWxpZFNvdXJjZU9wdGlvbnM7XG59XG5mdW5jdGlvbiBmaWx0ZXJWYWxpZENsaU9wdGlvbnMoXG4gIG9wdGlvbnM6IFJ1bldvcmtmbG93T3B0aW9ucyxcbik6IFJ1bldvcmtmbG93T3B0aW9ucyB7XG4gIGNvbnN0IHZhbGlkV29ya2Zsb3dPcHRpb25zOiBSdW5Xb3JrZmxvd09wdGlvbnMgPSB7fTtcbiAgVmFsaWRDbGlXb3JrZmxvd0ZsYWdzLmZvckVhY2goKGtleSkgPT4ge1xuICAgIGlmIChrZXkgaW4gb3B0aW9ucykge1xuICAgICAgdmFsaWRXb3JrZmxvd09wdGlvbnNba2V5XSA9IG9wdGlvbnNba2V5XTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdmFsaWRXb3JrZmxvd09wdGlvbnM7XG59XG5mdW5jdGlvbiBmaWx0ZXJWYWxpZFdvcmtmbG93T3B0aW9ucyhcbiAgb3B0aW9uczogV29ya2Zsb3dPcHRpb25zLFxuKTogV29ya2Zsb3dPcHRpb25zIHtcbiAgY29uc3QgdmFsaWRXb3JrZmxvd09wdGlvbnM6IFdvcmtmbG93T3B0aW9ucyA9IHt9O1xuXG4gIFZhbGlkV29ya2Zsb3dGbGFncy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICBpZiAoa2V5IGluIG9wdGlvbnMpIHtcbiAgICAgIHZhbGlkV29ya2Zsb3dPcHRpb25zW2tleV0gPSBvcHRpb25zW2tleV07XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gdmFsaWRXb3JrZmxvd09wdGlvbnM7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0RmluYWxXb3JrZmxvd09wdGlvbnMoXG4gIFdvcmtmbG93T3B0aW9uczogV29ya2Zsb3dPcHRpb25zLFxuICBydW5Xb3JrZmxvd09wdGlvbnM6IFJ1bldvcmtmbG93T3B0aW9ucyxcbik6IFdvcmtmbG93T3B0aW9ucyB7XG4gIGxldCBkYXRhYmFzZSA9IFwianNvbjovL2RhdGFcIjtcbiAgaWYgKHJ1bldvcmtmbG93T3B0aW9ucy5jb250ZW50KSB7XG4gICAgZGF0YWJhc2UgPSBcImpzb246Ly8vdG1wL2Rlbm9mbG93L2RhdGFcIjtcbiAgfVxuICBjb25zdCBkZWZhdWx0T3B0aW9uczogV29ya2Zsb3dPcHRpb25zID0ge1xuICAgIGRlYnVnOiBmYWxzZSxcbiAgICBkYXRhYmFzZTogZGF0YWJhc2UsXG4gICAgaWY6IHRydWUsXG4gIH07XG4gIGNvbnN0IGZpbmFsT3B0aW9uczogV29ya2Zsb3dPcHRpb25zID0gbWVyZ2VBbGwoW1xuICAgIGRlZmF1bHRPcHRpb25zLFxuICAgIGZpbHRlclZhbGlkV29ya2Zsb3dPcHRpb25zKFdvcmtmbG93T3B0aW9ucyksXG4gICAgZmlsdGVyVmFsaWRDbGlPcHRpb25zKHJ1bldvcmtmbG93T3B0aW9ucyksXG4gIF0pO1xuXG4gIHJldHVybiBmaW5hbE9wdGlvbnM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaW5hbFNvdXJjZU9wdGlvbnMoXG4gIFdvcmtmbG93T3B0aW9uczogV29ya2Zsb3dPcHRpb25zLFxuICBydW5Xb3JrZmxvd09wdGlvbnM6IFJ1bldvcmtmbG93T3B0aW9ucyxcbiAgc291cmNlT3B0aW9uczogU291cmNlT3B0aW9ucyxcbik6IFNvdXJjZU9wdGlvbnMge1xuICBjb25zdCBkZWZhdWx0T3B0aW9uczogU291cmNlT3B0aW9ucyA9IHtcbiAgICBmb3JjZTogZmFsc2UsXG4gICAgZGVidWc6IGZhbHNlLFxuICAgIGlmOiB0cnVlLFxuICB9O1xuXG4gIGNvbnN0IHZhbGlkUnVuV29ya2Zsb3dPcHRpb25zID0gZmlsdGVyVmFsaWRTb3VyY2VPcHRpb25zKFxuICAgIHJ1bldvcmtmbG93T3B0aW9ucyxcbiAgKTtcbiAgY29uc3QgZmluYWxPcHRpb25zOiBTb3VyY2VPcHRpb25zID0gbWVyZ2VBbGwoW1xuICAgIGRlZmF1bHRPcHRpb25zLFxuICAgIFdvcmtmbG93T3B0aW9ucyxcbiAgICBzb3VyY2VPcHRpb25zLFxuICAgIHZhbGlkUnVuV29ya2Zsb3dPcHRpb25zLFxuICBdKSBhcyBTb3VyY2VPcHRpb25zO1xuXG4gIHJldHVybiBmaW5hbE9wdGlvbnM7XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0RmluYWxSdW5PcHRpb25zKFxuICBydW5Xb3JrZmxvd09wdGlvbnM6IFJ1bldvcmtmbG93T3B0aW9ucyxcbiAgaXNEZWJ1ZzogYm9vbGVhbixcbik6IEludGVybmFsUnVuV29ya2Zsb3dPcHRpb25zIHtcbiAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IEludGVybmFsUnVuV29ya2Zsb3dPcHRpb25zID0ge1xuICAgIGZpbGVzOiBbXCJ3b3JrZmxvd3NcIl0sXG4gICAgZGVidWc6IGlzRGVidWcsXG4gICAgc3RkaW46IGZhbHNlLFxuICB9O1xuICBjb25zdCBmaW5hbE9wdGlvbnM6IEludGVybmFsUnVuV29ya2Zsb3dPcHRpb25zID0gbWVyZ2VBbGwoW1xuICAgIGRlZmF1bHRPcHRpb25zLFxuICAgIHJ1bldvcmtmbG93T3B0aW9ucyxcbiAgXSkgYXMgSW50ZXJuYWxSdW5Xb3JrZmxvd09wdGlvbnM7XG5cbiAgcmV0dXJuIGZpbmFsT3B0aW9ucztcbn1cbmNvbnN0IG92ZXJ3cml0ZU1lcmdlID0gKF86IHVua25vd24sIHNvdXJjZUFycmF5OiB1bmtub3duLCBfXzogdW5rbm93bikgPT5cbiAgc291cmNlQXJyYXk7XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZUFsbChhcnI6IHVua25vd25bXSkge1xuICByZXR1cm4gZGVlcG1lcmdlLmFsbChhcnIsIHsgYXJyYXlNZXJnZTogb3ZlcndyaXRlTWVyZ2UgfSk7XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsT0FBTyxlQUFlLGlDQUFpQztBQUV2RCxNQUFNLHFCQUFxQjtJQUN6QjtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7Q0FDRDtBQUNELE1BQU0sd0JBQXdCLG1CQUFtQixNQUFNLENBQUM7QUFDeEQsU0FBUyx5QkFDUCxPQUEyQixFQUNaO0lBQ2YsTUFBTSxFQUFFLE1BQUssRUFBRSxNQUFLLEVBQUUsTUFBSyxFQUFFLEdBQUcsV0FBVyxDQUFDO0lBRTVDLE1BQU0scUJBQThDO1FBQ2xEO1FBQ0E7UUFDQTtJQUNGO0lBQ0EsT0FBTyxJQUFJLENBQUMsb0JBQW9CLE9BQU8sQ0FBQyxDQUFDLE1BQ3ZDLGtCQUFrQixDQUFDLElBQUksS0FBSyxhQUFhLE9BQU8sa0JBQWtCLENBQUMsSUFBSTtJQUd6RSxPQUFPO0FBQ1Q7QUFDQSxTQUFTLHNCQUNQLE9BQTJCLEVBQ1A7SUFDcEIsTUFBTSx1QkFBMkMsQ0FBQztJQUNsRCxzQkFBc0IsT0FBTyxDQUFDLENBQUMsTUFBUTtRQUNyQyxJQUFJLE9BQU8sU0FBUztZQUNsQixvQkFBb0IsQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUk7UUFDMUMsQ0FBQztJQUNIO0lBQ0EsT0FBTztBQUNUO0FBQ0EsU0FBUywyQkFDUCxPQUF3QixFQUNQO0lBQ2pCLE1BQU0sdUJBQXdDLENBQUM7SUFFL0MsbUJBQW1CLE9BQU8sQ0FBQyxDQUFDLE1BQVE7UUFDbEMsSUFBSSxPQUFPLFNBQVM7WUFDbEIsb0JBQW9CLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJO1FBQzFDLENBQUM7SUFDSDtJQUVBLE9BQU87QUFDVDtBQUNBLE9BQU8sU0FBUyx3QkFDZCxlQUFnQyxFQUNoQyxrQkFBc0MsRUFDckI7SUFDakIsSUFBSSxXQUFXO0lBQ2YsSUFBSSxtQkFBbUIsT0FBTyxFQUFFO1FBQzlCLFdBQVc7SUFDYixDQUFDO0lBQ0QsTUFBTSxpQkFBa0M7UUFDdEMsT0FBTyxLQUFLO1FBQ1osVUFBVTtRQUNWLElBQUksSUFBSTtJQUNWO0lBQ0EsTUFBTSxlQUFnQyxTQUFTO1FBQzdDO1FBQ0EsMkJBQTJCO1FBQzNCLHNCQUFzQjtLQUN2QjtJQUVELE9BQU87QUFDVCxDQUFDO0FBRUQsT0FBTyxTQUFTLHNCQUNkLGVBQWdDLEVBQ2hDLGtCQUFzQyxFQUN0QyxhQUE0QixFQUNiO0lBQ2YsTUFBTSxpQkFBZ0M7UUFDcEMsT0FBTyxLQUFLO1FBQ1osT0FBTyxLQUFLO1FBQ1osSUFBSSxJQUFJO0lBQ1Y7SUFFQSxNQUFNLDBCQUEwQix5QkFDOUI7SUFFRixNQUFNLGVBQThCLFNBQVM7UUFDM0M7UUFDQTtRQUNBO1FBQ0E7S0FDRDtJQUVELE9BQU87QUFDVCxDQUFDO0FBQ0QsT0FBTyxTQUFTLG1CQUNkLGtCQUFzQyxFQUN0QyxPQUFnQixFQUNZO0lBQzVCLE1BQU0saUJBQTZDO1FBQ2pELE9BQU87WUFBQztTQUFZO1FBQ3BCLE9BQU87UUFDUCxPQUFPLEtBQUs7SUFDZDtJQUNBLE1BQU0sZUFBMkMsU0FBUztRQUN4RDtRQUNBO0tBQ0Q7SUFFRCxPQUFPO0FBQ1QsQ0FBQztBQUNELE1BQU0saUJBQWlCLENBQUMsR0FBWSxhQUFzQixLQUN4RDtBQUVGLE9BQU8sU0FBUyxTQUFTLEdBQWMsRUFBRTtJQUN2QyxPQUFPLFVBQVUsR0FBRyxDQUFDLEtBQUs7UUFBRSxZQUFZO0lBQWU7QUFDekQsQ0FBQyJ9