import { Buffer } from "https://deno.land/std@0.86.0/node/buffer.ts";
// deno-lint-ignore no-namespace
export var JSONB;
(function(JSONB) {
    var stringify = JSONB.stringify = function stringify(o) {
        if ("undefined" == typeof o) return o;
        if (o && Buffer.isBuffer(o)) return JSON.stringify(":base64:" + o.toString("base64"));
        if (o && o instanceof Map) return JSON.stringify(":map:" + JSON.stringify(Object.fromEntries(o)));
        if (o && o.toJSON) o = o.toJSON();
        if (o && "object" === typeof o) {
            var s = "";
            var array = Array.isArray(o);
            s = array ? "[" : "{";
            var first = true;
            for(var k in o){
                var ignore = "function" == typeof o[k] || !array && "undefined" === typeof o[k];
                if (Object.hasOwnProperty.call(o, k) && !ignore) {
                    if (!first) s += ",";
                    first = false;
                    if (array) {
                        if (o[k] == undefined) s += "null";
                        else s += stringify(o[k]);
                    } else if (o[k] !== void 0) {
                        s += stringify(k) + ":" + stringify(o[k]);
                    }
                }
            }
            s += array ? "]" : "}";
            return s;
        } else if ("string" === typeof o) {
            return JSON.stringify(/^:/.test(o) ? ":" + o : o);
        } else if ("undefined" === typeof o) {
            return "null";
        } else return JSON.stringify(o);
    };
    var parse = JSONB.parse = function(s) {
        return JSON.parse(s, function(_, value) {
            if ("string" === typeof value) {
                if (/^:base64:/.test(value)) return Buffer.from(value.substring(8), "base64");
                if (/^:map:/.test(value)) return new Map(Object.entries(JSON.parse(value.substring(5))));
                else return /^:/.test(value) ? value.substring(1) : value;
            }
            return value;
        });
    };
})(JSONB || (JSONB = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gva2V5ZGJAMS4wLjAvanNvbmIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnVmZmVyIH0gZnJvbSBcImh0dHBzOi8vZGVuby5sYW5kL3N0ZEAwLjg2LjAvbm9kZS9idWZmZXIudHNcIjtcclxuXHJcbi8vIGRlbm8tbGludC1pZ25vcmUgbm8tbmFtZXNwYWNlXHJcbmV4cG9ydCBuYW1lc3BhY2UgSlNPTkIge1xyXG4gIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XHJcbiAgZXhwb3J0IGNvbnN0IHN0cmluZ2lmeSA9IGZ1bmN0aW9uIHN0cmluZ2lmeShvOiBhbnkpIHtcclxuICAgIGlmIChcInVuZGVmaW5lZFwiID09IHR5cGVvZiBvKSByZXR1cm4gbztcclxuXHJcbiAgICBpZiAobyAmJiBCdWZmZXIuaXNCdWZmZXIobykpXHJcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShcIjpiYXNlNjQ6XCIgKyBvLnRvU3RyaW5nKFwiYmFzZTY0XCIpKTtcclxuICAgIGlmIChvICYmIG8gaW5zdGFuY2VvZiBNYXApXHJcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShcIjptYXA6XCIgKyBKU09OLnN0cmluZ2lmeShPYmplY3QuZnJvbUVudHJpZXMobykpKTtcclxuXHJcbiAgICBpZiAobyAmJiBvLnRvSlNPTikgbyA9IG8udG9KU09OKCk7XHJcblxyXG4gICAgaWYgKG8gJiYgXCJvYmplY3RcIiA9PT0gdHlwZW9mIG8pIHtcclxuICAgICAgdmFyIHMgPSBcIlwiO1xyXG4gICAgICB2YXIgYXJyYXkgPSBBcnJheS5pc0FycmF5KG8pO1xyXG4gICAgICBzID0gYXJyYXkgPyBcIltcIiA6IFwie1wiO1xyXG4gICAgICB2YXIgZmlyc3QgPSB0cnVlO1xyXG5cclxuICAgICAgZm9yICh2YXIgayBpbiBvKSB7XHJcbiAgICAgICAgdmFyIGlnbm9yZSA9XHJcbiAgICAgICAgICBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG9ba10gfHwgKCFhcnJheSAmJiBcInVuZGVmaW5lZFwiID09PSB0eXBlb2Ygb1trXSk7XHJcbiAgICAgICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIGspICYmICFpZ25vcmUpIHtcclxuICAgICAgICAgIGlmICghZmlyc3QpIHMgKz0gXCIsXCI7XHJcbiAgICAgICAgICBmaXJzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgaWYgKGFycmF5KSB7XHJcbiAgICAgICAgICAgIGlmIChvW2tdID09IHVuZGVmaW5lZCkgcyArPSBcIm51bGxcIjtcclxuICAgICAgICAgICAgZWxzZSBzICs9IHN0cmluZ2lmeShvW2tdKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAob1trXSAhPT0gdm9pZCAwKSB7XHJcbiAgICAgICAgICAgIHMgKz0gc3RyaW5naWZ5KGspICsgXCI6XCIgKyBzdHJpbmdpZnkob1trXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBzICs9IGFycmF5ID8gXCJdXCIgOiBcIn1cIjtcclxuXHJcbiAgICAgIHJldHVybiBzO1xyXG4gICAgfSBlbHNlIGlmIChcInN0cmluZ1wiID09PSB0eXBlb2Ygbykge1xyXG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoL146Ly50ZXN0KG8pID8gXCI6XCIgKyBvIDogbyk7XHJcbiAgICB9IGVsc2UgaWYgKFwidW5kZWZpbmVkXCIgPT09IHR5cGVvZiBvKSB7XHJcbiAgICAgIHJldHVybiBcIm51bGxcIjtcclxuICAgIH0gZWxzZSByZXR1cm4gSlNPTi5zdHJpbmdpZnkobyk7XHJcbiAgfTtcclxuXHJcbiAgZXhwb3J0IGNvbnN0IHBhcnNlID0gZnVuY3Rpb24gKHM6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIEpTT04ucGFyc2UocywgZnVuY3Rpb24gKF8sIHZhbHVlKSB7XHJcbiAgICAgIGlmIChcInN0cmluZ1wiID09PSB0eXBlb2YgdmFsdWUpIHtcclxuICAgICAgICBpZiAoL146YmFzZTY0Oi8udGVzdCh2YWx1ZSkpXHJcbiAgICAgICAgICByZXR1cm4gQnVmZmVyLmZyb20odmFsdWUuc3Vic3RyaW5nKDgpLCBcImJhc2U2NFwiKTtcclxuICAgICAgICBpZiAoL146bWFwOi8udGVzdCh2YWx1ZSkpXHJcbiAgICAgICAgICByZXR1cm4gbmV3IE1hcChPYmplY3QuZW50cmllcyhKU09OLnBhcnNlKHZhbHVlLnN1YnN0cmluZyg1KSkpKTtcclxuICAgICAgICBlbHNlIHJldHVybiAvXjovLnRlc3QodmFsdWUpID8gdmFsdWUuc3Vic3RyaW5nKDEpIDogdmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfSk7XHJcbiAgfTtcclxufVxyXG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsU0FBUyxNQUFNLFFBQVEsNkNBQTZDLENBQUM7QUFFckUsZ0NBQWdDO0FBQ2hDLE9BQU8sSUFBVSxLQUFLLENBdURyQjs7UUFyRGMsU0FBUyxTQUFULFNBQVMsR0FBRyxTQUFTLFNBQVMsQ0FBQyxDQUFNLEVBQUU7UUFDbEQsSUFBSSxXQUFXLElBQUksT0FBTyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFdEMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFDekIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEdBQUcsRUFDdkIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXpFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUVs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